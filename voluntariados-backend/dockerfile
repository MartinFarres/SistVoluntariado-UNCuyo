FROM python:3.11-slim

ENV PYTHONUNBUFFERED=1 \
		PIP_NO_CACHE_DIR=1

WORKDIR /app

# System deps
RUN apt-get update && apt-get install -y --no-install-recommends \
		cron \
		bash \
		ca-certificates \
	&& rm -rf /var/lib/apt/lists/*

COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# App source
COPY . .

# Entrypoint scripts
RUN mkdir -p /var/log && touch /var/log/cron.log \
	&& chmod +x compose/start.sh compose/entrypoint.sh || true

EXPOSE 8000

# Default command: run startup script which configures cron and launches gunicorn
CMD ["bash", "compose/start.sh"]